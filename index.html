<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Adaptive Learning Unleashed</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root {
            --bg-0: #0a0f1a;
            --bg-1: #0e1526;
            --bg-2: #0f1b33;
            --ink-0: #e8f1ff;
            --ink-1: #b9c8e8;
            --sky-1: #0ea5e9;
            --sky-2: #22d3ee;
            --ok: #22c55e;
            --warn: #f59e0b;
            --err: #ef4444;
            --focus: #93c5fd;
            --shadow: 0 10px 24px rgba(0,0,0,.35);
        }

        body {
            margin: 0;
            color: var(--ink-0);
            font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
            background: radial-gradient(1200px 800px at 70% -10%,rgba(34,211,238,.10),transparent 60%), radial-gradient(1000px 600px at -10% 20%,rgba(14,165,233,.15),transparent 55%), linear-gradient(180deg,#07101e 0%,#0a1322 50%,#0b1628 100%);
            min-height: 100dvh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .wrap {
            background: linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.015)),var(--bg-1);
            border: 1px solid rgba(148,163,184,.15);
            border-radius: 16px;
            box-shadow: var(--shadow);
            padding: 40px 32px;
            max-width: 520px;
            width: 92%;
            text-align: center;
        }

        h1 {
            margin: 0;
            font-size: clamp(24px,3vw,32px);
            background: linear-gradient(90deg,var(--ink-0),#cfe8ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .subtitle {
            margin: 20px 0 0;
            color: var(--ink-0);
            font-size: 1.6rem;
            font-weight: 600;
            letter-spacing: .5px;
            text-align: center;
            text-shadow: 0 1px 6px rgba(34,211,238,0.35);
        }

        input {
            width: 100%;
            padding: 12px 14px;
            border-radius: 10px;
            border: 1px solid rgba(148,163,184,.35);
            background: #0f1a2e;
            color: var(--ink-0);
            font-size: 16px;
            margin-top: 16px;
            box-sizing: border-box;
            outline: none;
        }

            input:focus {
                border-color: var(--focus);
                box-shadow: 0 0 0 3px rgba(147,197,253,.25);
            }

        .error {
            margin: 8px 0 0;
            color: var(--err);
            font-size: 0.9rem;
            text-align: left;
        }

        button {
            margin-top: 14px;
            width: 100%;
            padding: 12px 16px;
            font-size: 16px;
            border-radius: 10px;
            border: 1px solid rgba(34,211,238,.55);
            background: linear-gradient(180deg,#0e87c7,#0c6aa0);
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 6px 24px rgba(14,165,233,.35);
            transition: transform .1s ease, box-shadow .2s ease, opacity .2s ease;
        }

            button:hover:not([disabled]) {
                transform: translateY(-2px);
                box-shadow: 0 8px 28px rgba(14,165,233,.45);
            }

            button[disabled] {
                opacity: .6;
                cursor: not-allowed;
            }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            padding: 8px 12px;
            border-radius: 999px;
            background: rgba(14,165,233,.10);
            border: 1px solid rgba(34,211,238,.35);
            margin-top: 16px;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--warn);
        }

            .dot.ok {
                background: var(--ok);
                box-shadow: 0 0 0 0 rgba(34,197,94,.6);
                animation: pulse 1.8s ease-out infinite;
            }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(34,197,94,.5)
            }

            70% {
                box-shadow: 0 0 0 10px rgba(34,197,94,0)
            }

            100% {
                box-shadow: 0 0 0 0 rgba(34,197,94,0)
            }
        }
    </style>
</head>
<body>
    <main class="wrap">
        <h1>Welcome to Adaptive Learning Unleashed</h1>
        <div class="badge" aria-live="polite">
            <span class="dot" id="connDot"></span>
            <span id="connText">Checking connection…</span>
        </div>

        <p class="subtitle">Please enter your name and email to begin.</p>
        <input id="nameInput" type="text" placeholder="Your Name" autocomplete="name" required />
        <input id="emailInput" type="email" placeholder="Your Email" autocomplete="email" required />
        <p id="emailError" class="error" hidden>Enter a valid email like name@example.com.</p>
        <button id="btnLaunch" disabled>Launch</button>
    </main>

    <script>
        // ---------- Connection check (unchanged) ----------
        const endpoint = "https://cloud.scorm.com/lrs/TENBKY6BZ6/sandbox/";
        const key = "d_cPqAqYNvM3sMTyJ2M";
        const secret = "rh70yfaxONPyu11z_vk";
        const auth = "Basic " + btoa(`${key}:${secret}`);
        async function checkConnection() {
            const dot = document.getElementById("connDot");
            const txt = document.getElementById("connText");
            try {
                const r = await fetch(endpoint + "about", { headers: { Authorization: auth } });
                if (r.ok) { dot.classList.add("ok"); txt.textContent = "Connected"; }
                else { txt.textContent = "Connection unstable"; }
            } catch { txt.textContent = "Offline"; dot.style.background = "var(--err)"; }
        }
        checkConnection();

        // ---------- Session ID ----------
        function ensureSid() {
            let sid = localStorage.getItem("sessionId");
            if (!sid) { sid = self.crypto?.randomUUID?.() || String(Date.now()); localStorage.setItem("sessionId", sid); }
            return sid;
        }

        // ---------- Validation ----------
        const nameInput = document.getElementById("nameInput");
        const emailInput = document.getElementById("emailInput");
        const emailError = document.getElementById("emailError");
        const btn = document.getElementById("btnLaunch");
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;

        function isEmailValid(value) {
            const v = (value || "").trim();
            // Use native email validity first; fall back to regex for consistency
            return (emailInput.type === "email" && emailInput.checkValidity())
                || emailRegex.test(v.toLowerCase());
        }

        function validate() {
            const nameOk = nameInput.value.trim().length > 0;
            const emailOk = isEmailValid(emailInput.value);

            emailError.hidden = emailInput.value.trim() === "" || emailOk;
            btn.disabled = !(nameOk && emailOk);
        }

        // Handle typing + common autofill quirks
        ["input", "change", "blur"].forEach(evt => {
            nameInput.addEventListener(evt, validate);
            emailInput.addEventListener(evt, validate);
        });

        // Run validation on load and after autofill settles
        window.addEventListener("DOMContentLoaded", () => {
            requestAnimationFrame(validate);
            setTimeout(validate, 150);   // catches Chrome/Safari autofill
        });
        window.addEventListener("pageshow", validate);
        document.addEventListener("visibilitychange", () => { if (!document.hidden) validate(); });

        // Enter to submit only when valid
        document.addEventListener("keydown", e => {
            if (e.key === "Enter" && !btn.disabled) btn.click();
        });

        // ---------- Launch ----------
        btn.addEventListener("click", () => {
            const name = nameInput.value.trim();
            const email = emailInput.value.trim().toLowerCase();

            if (!name || !isEmailValid(email)) {
                validate();
                if (!isEmailValid(email)) { emailInput.focus(); }
                return;
            }

            localStorage.setItem("learnerName", name);
            localStorage.setItem("learnerEmail", email);
            const sid = ensureSid();
            localStorage.setItem("currentCompetency", "C1");

            window.location.href = `next.html?learnerName=${encodeURIComponent(name)}&sid=${encodeURIComponent(sid)}&current=C1`;
        });
    </script>
</body>
</html>
