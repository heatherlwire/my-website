<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Analyzing your progress</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
        :root {
            --bg-0: #0a0f1a;
            --bg-1: #0e1526;
            --bg-2: #0f1b33;
            --ink-0: #e8f1ff;
            --ink-1: #b9c8e8;
            --sky-1: #0ea5e9;
            --sky-2: #22d3ee;
            --ok: #22c55e;
            --warn: #f59e0b;
            --err: #ef4444;
            --focus: #93c5fd;
            --shadow: 0 10px 24px rgba(0,0,0,.35);
        }

        body {
            margin: 0;
            color: var(--ink-0);
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
            background: radial-gradient(1200px 800px at 70% -10%, rgba(34,211,238,.10), transparent 60%), radial-gradient(1000px 600px at -10% 20%, rgba(14,165,233,.15), transparent 55%), linear-gradient(180deg, #07101e 0%, #0a1322 50%, #0b1628 100%);
            min-height: 100dvh;
        }

        header {
            padding: 28px 24px 10px;
        }

        .title-row {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        h1 {
            margin: 0;
            font-size: clamp(22px, 2.4vw, 28px);
            background: linear-gradient(90deg, var(--ink-0), #cfe8ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            padding: 8px 12px;
            border-radius: 999px;
            background: rgba(14,165,233,.10);
            border: 1px solid rgba(34,211,238,.35);
        }

        .wrap {
            padding: 6px 24px 32px;
            max-width: 1100px;
            margin: 0 auto;
        }

        .card {
            background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015)), var(--bg-1);
            border: 1px solid rgba(148,163,184,.15);
            border-radius: 14px;
            padding: 20px 18px;
            margin: 16px 0;
            box-shadow: var(--shadow);
        }

        .muted {
            color: var(--ink-1);
        }
    </style>
</head>

<body>
    <header>
        <div class="title-row">
            <h1>Analyzing your progress</h1>
        </div>
    </header>

    <main class="wrap">
        <!-- Your progress display section -->
        <div class="card">
            <p class="muted">We are analyzing your progress based on the test results. This will take just a moment...</p>
            <div id="status" class="loading">Analyzing...</div>
        </div>
    </main>

    <script>
        // ========================================================
        // Detect and validate competency based on LRS summary
        // ========================================================
        function getLRSData() {
            return JSON.parse(localStorage.getItem('summaryData') || '{}');
        }

        // Update summary with missed and completed subcompetencies
        function updateMissedSubCompetencies(summary) {
            ["C1", "C2", "C3"].forEach((compKey) => {
                const s = summary[compKey];
                if (!s) return;

                const missed = Array.isArray(s.missed) ? s.missed : [];
                const done = Array.isArray(s.subsCompleted) ? s.subsCompleted : [];

                if (!missed.length || !done.length) {
                    s.missed = missed;
                    return;
                }

                const doneLower = done.map(x => String(x).toLowerCase());
                s.missed = missed.filter(m => !doneLower.includes(String(m).toLowerCase()));
            });

            return summary;
        }

        // ============================================================
        // Detect Current Competency
        // ============================================================
        function detectCurrent(summary) {
            const C1 = summary.C1 || {};
            const C2 = summary.C2 || {};
            const C3 = summary.C3 || {};

            const m1 = C1.mastery;
            const f1 = C1.finalized;
            const m2 = C2.mastery;
            const f2 = C2.finalized;
            const m3 = C3.mastery;
            const f3 = C3.finalized;

            if (!m1 && !f1) return "C1";
            if (m1 && m1 !== "Mastery" && !f1) return "C1";
            if ((m1 === "Mastery" || f1) && (!m2 && !f2)) return "C2";
            if ((m1 === "Mastery" || f1) && (m2 && m2 !== "Mastery" && !f2)) return "C2";
            if ((m1 === "Mastery" || f1) &&
                (m2 === "Mastery" || f2) &&
                (!m3 && !f3)) return "C3";
            if ((m1 === "Mastery" || f1) &&
                (m2 === "Mastery" || f2) &&
                (m3 && m3 !== "Mastery" && !f3)) return "C3";

            return "C3";
        }

        // ============================================================
        // Build Routes
        // ============================================================
        function buildRoutes(summary, rules) {
            const currentComp = detectCurrent(summary);
            const currentRules = rules[currentComp];
            // Apply the rule logic to determine the next step
        }

        // ============================================================
        // Main Function to Trigger Routing Logic and Show Results
        // ============================================================
        function runAnalysis() {
            const summary = getLRSData();
            const routes = buildRoutes(summary, rules);
            console.log(routes); // Debug output

            // Final message or redirect after analysis
            document.getElementById('status').textContent = 'Analysis complete. Routing your next steps.';
        }

        // Run the analysis on page load
        runAnalysis();
    </script>
</body>
</html>
