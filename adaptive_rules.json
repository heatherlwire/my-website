{
  "meta": {
    "version": "1.1.0",
    "lastUpdated": "2025-11-16",
    "author": "Wire LXD Firm",
    "description": "Adaptive Routing Rules for Competency-Based Learning (C1–C3) – deterministic ordering, completed flag, normalized structure",
    "namespace": "https://acbl.wirelxdfirm.com/extensions/",
    "conventions": {
      "masteryLevels": [ "Mastery", "Proficient", "Emerging", "Failing" ],
      "testedOut": "3/3 on first attempt",
      "finalized": "set by off-ramp button on next.html",
      "missed": "array like ['C1b']",
      "deterministicOrder": "C1a → C1b → C1c",
      "targets": "strings such as C1-test, C1a-content, program-complete"
    }
  },

  "C1": [
    {
      "if": { "finalized": true },
      "then": [
        { "set": { "completed": true } },
        { "route": { "go": "C2-test" } }
      ]
    },
    {
      "if": { "testedOut": true },
      "then": [
        { "set": { "completed": true } },
        { "route": { "go": "C2-test" } }
      ]
    },
    {
      "if": { "mastery": "Mastery" },
      "then": [
        { "set": { "completed": true } },
        { "route": { "go": "C2-test" } }
      ]
    },
    {
      "if": { "mastery": "Proficient" },
      "then": [
        {
          "routeMissed": {
            "ordered": [ "C1a", "C1b", "C1c" ]
          }
        },
        { "route": { "go": "C1-test" } }
      ]
    },
    {
      "if": { "masteryIn": [ "Emerging", "Failing" ] },
      "then": [
        { "routeAll": { "ordered": [ "C1a", "C1b", "C1c" ] } },
        { "route": { "go": "C1-test" } }
      ]
    },
    {
      "if": { "mastery": null },
      "then": [
        { "route": { "go": "C1-test" } }
      ]
    },
    {
      "if": {},
      "then": [
        { "route": { "go": "C1-test" } }
      ]
    }
  ],

  "C2": [
    {
      "if": { "finalized": true },
      "then": [
        { "set": { "completed": true } },
        { "route": { "go": "C3-test" } }
      ]
    },
    {
      "if": { "testedOut": true },
      "then": [
        { "set": { "completed": true } },
        { "route": { "go": "C3-test" } }
      ]
    },
    {
      "if": { "mastery": "Mastery" },
      "then": [
        { "set": { "completed": true } },
        { "route": { "go": "C3-test" } }
      ]
    },
    {
      "if": { "mastery": "Proficient" },
      "then": [
        {
          "routeMissed": {
            "ordered": [ "C2a", "C2b", "C2c" ]
          }
        },
        { "route": { "go": "C2-test" } }
      ]
    },
    {
      "if": { "masteryIn": [ "Emerging", "Failing" ] },
      "then": [
        { "routeAll": { "ordered": [ "C2a", "C2b", "C2c" ] } },
        { "route": { "go": "C2-test" } }
      ]
    },
    {
      "if": { "mastery": null },
      "then": [
        { "route": { "go": "C2-test" } }
      ]
    },
    {
      "if": {},
      "then": [
        { "route": { "go": "C2-test" } }
      ]
    }
  ],

  "C3": [
    {
      "if": { "finalized": true },
      "then": [
        { "set": { "completed": true } },
        { "route": { "go": "program-complete" } }
      ]
    },
    {
      "if": { "testedOut": true },
      "then": [
        { "set": { "completed": true } },
        { "route": { "go": "program-complete" } }
      ]
    },
    {
      "if": { "mastery": "Mastery" },
      "then": [
        { "set": { "completed": true } },
        { "route": { "go": "program-complete" } }
      ]
    },
    {
      "if": { "mastery": "Proficient" },
      "then": [
        {
          "routeMissed": {
            "ordered": [ "C3a", "C3b", "C3c" ]
          }
        },
        { "route": { "go": "C3-test" } }
      ]
    },
    {
      "if": { "masteryIn": [ "Emerging", "Failing" ] },
      "then": [
        { "routeAll": { "ordered": [ "C3a", "C3b", "C3c" ] } },
        { "route": { "go": "C3-test" } }
      ]
    },
    {
      "if": { "mastery": null },
      "then": [
        { "route": { "go": "C3-test" } }
      ]
    },
    {
      "if": {},
      "then": [
        { "route": { "go": "C3-test" } }
      ]
    }
  ]
}
