{
  "meta": {
    "version": "1.0.3",
    "lastUpdated": "2025-11-15",
    "author": "Wire LXD Firm",
    "description": "Adaptive Routing Rules for Competency-Based Learning (C1–C3) – normalized for next.html",
    "namespace": "https://acbl.wirelxdfirm.com/extensions/",
    "conventions": {
      "masteryLevels": [ "Mastery", "Proficient", "Emerging", "Failing" ],
      "testedOut": "3/3 on first attempt",
      "finalized": "set by off-ramp button on next.html",
      "missed": "array of missed sub-competencies like ['C1b']",
      "targets": "strings such as C1-test, C1a-content, C1a-apply, program-complete"
    }
  },

  "C1": [
    {
      "if": { "finalized": true },
      "then": [
        { "route": { "go": "C2-test" } }
      ]
    },
    {
      "if": { "testedOut": true },
      "then": [
        { "route": { "go": "C2-test" } }
      ]
    },
    {
      "if": { "mastery": "Mastery" },
      "then": [
        { "route": { "go": "C2-test" } }
      ]
    },
    {
      "if": { "mastery": "Proficient" },
      "then": [
        {
          "forEach": "missed",
          "do": [
            { "route": { "go": "{item}-content" } },
            { "route": { "go": "{item}-apply" } }
          ]
        },
        { "route": { "go": "C1-test" } }
      ]
    },
    {
      "if": { "masteryIn": [ "Emerging", "Failing" ] },
      "then": [
        { "route": { "go": "C1a-content" } },
        { "route": { "go": "C1a-apply" } },
        { "route": { "go": "C1b-content" } },
        { "route": { "go": "C1b-apply" } },
        { "route": { "go": "C1c-content" } },
        { "route": { "go": "C1c-apply" } },
        { "route": { "go": "C1-test" } }
      ]
    },
    {
      "if": { "mastery": null },
      "then": [
        { "route": { "go": "C1-test" } }
      ]
    },
    {
      "if": {},
      "then": [
        { "route": { "go": "C1-test" } }
      ]
    }
  ],

  "C2": [
    {
      "if": { "finalized": true },
      "then": [
        { "route": { "go": "C3-test" } }
      ]
    },
    {
      "if": { "testedOut": true },
      "then": [
        { "route": { "go": "C3-test" } }
      ]
    },
    {
      "if": { "mastery": "Mastery" },
      "then": [
        { "route": { "go": "C3-test" } }
      ]
    },
    {
      "if": { "mastery": "Proficient" },
      "then": [
        {
          "forEach": "missed",
          "do": [
            { "route": { "go": "{item}-content" } },
            { "route": { "go": "{item}-apply" } }
          ]
        },
        { "route": { "go": "C2-test" } }
      ]
    },
    {
      "if": { "masteryIn": [ "Emerging", "Failing" ] },
      "then": [
        { "route": { "go": "C2a-content" } },
        { "route": { "go": "C2a-apply" } },
        { "route": { "go": "C2b-content" } },
        { "route": { "go": "C2b-apply" } },
        { "route": { "go": "C2c-content" } },
        { "route": { "go": "C2c-apply" } },
        { "route": { "go": "C2-test" } }
      ]
    },
    {
      "if": { "mastery": null },
      "then": [
        { "route": { "go": "C2-test" } }
      ]
    },
    {
      "if": {},
      "then": [
        { "route": { "go": "C2-test" } }
      ]
    }
  ],

  "C3": [
    {
      "if": { "finalized": true },
      "then": [
        { "route": { "go": "program-complete" } }
      ]
    },
    {
      "if": { "testedOut": true },
      "then": [
        { "route": { "go": "program-complete" } }
      ]
    },
    {
      "if": { "mastery": "Mastery" },
      "then": [
        { "route": { "go": "program-complete" } }
      ]
    },
    {
      "if": { "mastery": "Proficient" },
      "then": [
        {
          "forEach": "missed",
          "do": [
            { "route": { "go": "{item}-content" } },
            { "route": { "go": "{item}-apply" } }
          ]
        },
        { "route": { "go": "C3-test" } }
      ]
    },
    {
      "if": { "masteryIn": [ "Emerging", "Failing" ] },
      "then": [
        { "route": { "go": "C3a-content" } },
        { "route": { "go": "C3a-apply" } },
        { "route": { "go": "C3b-content" } },
        { "route": { "go": "C3b-apply" } },
        { "route": { "go": "C3c-content" } },
        { "route": { "go": "C3c-apply" } },
        { "route": { "go": "C3-test" } }
      ]
    },
    {
      "if": { "mastery": null },
      "then": [
        { "route": { "go": "C3-test" } }
      ]
    },
    {
      "if": {},
      "then": [
        { "route": { "go": "C3-test" } }
      ]
    }
  ]
}
